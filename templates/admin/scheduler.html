<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®šæ—¶ä»»åŠ¡ - ç®¡ç†åå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-8">
                    <a href="/admin" class="text-xl font-bold text-gray-900">ğŸ“Š ç®¡ç†åå°</a>
                    <a href="/admin" class="text-gray-700 hover:text-blue-600">ä»ªè¡¨æ¿</a>
                    <a href="/admin/fetch" class="text-gray-700 hover:text-blue-600">æŠ“å–ç®¡ç†</a>
                    <a href="/admin/translate" class="text-gray-700 hover:text-blue-600">ç¿»è¯‘ç®¡ç†</a>
                    <a href="/admin/validate" class="text-gray-700 hover:text-blue-600">éªŒè¯ç®¡ç†</a>
                    <a href="/admin/scheduler" class="text-blue-600 font-semibold">å®šæ—¶ä»»åŠ¡</a>
                    <a href="/admin/settings" class="text-gray-700 hover:text-blue-600">ç³»ç»Ÿè®¾ç½®</a>
                </div>
                <a href="/" class="text-blue-600 hover:text-blue-800">â† è¿”å›å‰å°</a>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">å®šæ—¶ä»»åŠ¡ç®¡ç†</h1>

        <!-- ä»»åŠ¡çŠ¶æ€ -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">ä»»åŠ¡çŠ¶æ€</h2>
            <div class="flex items-center gap-4 mb-4">
                <div id="status-indicator" class="w-4 h-4 rounded-full bg-gray-400"></div>
                <span id="status-text" class="text-gray-600">æ£€æŸ¥ä¸­...</span>
                <span id="jobs-count" class="text-sm text-gray-500"></span>
            </div>
            <div class="flex gap-4">
                <button onclick="startScheduler()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                    å¯åŠ¨å®šæ—¶ä»»åŠ¡
                </button>
                <button onclick="stopScheduler()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                    åœæ­¢å®šæ—¶ä»»åŠ¡
                </button>
                <button onclick="checkStatus()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    åˆ·æ–°çŠ¶æ€
                </button>
            </div>
            <div id="message" class="mt-4 text-sm"></div>
            
            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <div id="jobs-list" class="mt-6 space-y-2"></div>
        </div>

        <!-- ä»»åŠ¡è¯´æ˜ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">å®šæ—¶ä»»åŠ¡è¯´æ˜</h2>
            
            <div class="space-y-6">
                <div class="border-l-4 border-green-500 pl-4">
                    <h3 class="font-semibold text-gray-900 mb-2">é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆæ¯å°æ—¶æ‰§è¡Œï¼‰</h3>
                    <p class="text-sm text-gray-600 mb-2">æŠ“å–ä»¥ä¸‹æ–°é—»æºï¼š</p>
                    <ul class="text-sm text-gray-600 list-disc list-inside">
                        <li>Reutersï¼ˆè·¯é€ç¤¾ï¼‰</li>
                        <li>AP Newsï¼ˆç¾è”ç¤¾ï¼‰</li>
                        <li>BBC News</li>
                        <li>Bloombergï¼ˆå½­åšç¤¾ï¼‰</li>
                        <li>Hacker News</li>
                        <li>AFPï¼ˆæ³•æ–°ç¤¾ï¼‰</li>
                    </ul>
                </div>

                <div class="border-l-4 border-blue-500 pl-4">
                    <h3 class="font-semibold text-gray-900 mb-2">ä¸­ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆæ¯6å°æ—¶æ‰§è¡Œï¼‰</h3>
                    <p class="text-sm text-gray-600 mb-2">æŠ“å–ä»¥ä¸‹æ–°é—»æºï¼š</p>
                    <ul class="text-sm text-gray-600 list-disc list-inside">
                        <li>The Guardianï¼ˆå«æŠ¥ï¼‰</li>
                        <li>The New York Timesï¼ˆçº½çº¦æ—¶æŠ¥ï¼‰</li>
                        <li>Al Jazeeraï¼ˆåŠå²›ç”µè§†å°ï¼‰</li>
                        <li>TechCrunch</li>
                        <li>Washington Postï¼ˆåç››é¡¿é‚®æŠ¥ï¼‰</li>
                        <li>Financial Timesï¼ˆé‡‘èæ—¶æŠ¥ï¼‰</li>
                        <li>Google News</li>
                        <li>NHK World</li>
                        <li>Japan Times</li>
                        <li>SCMPï¼ˆå—åæ—©æŠ¥ï¼‰</li>
                    </ul>
                </div>

                <div class="border-l-4 border-purple-500 pl-4">
                    <h3 class="font-semibold text-gray-900 mb-2">ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆæ¯å¤©æ‰§è¡Œï¼‰</h3>
                    <p class="text-sm text-gray-600 mb-2">æŠ“å–ä»¥ä¸‹æ–°é—»æºï¼š</p>
                    <ul class="text-sm text-gray-600 list-disc list-inside">
                        <li>è”åˆæ—©æŠ¥</li>
                        <li>The Economistï¼ˆç»æµå­¦äººï¼‰</li>
                        <li>Ars Technica</li>
                        <li>The Verge</li>
                        <li>8è§†ç•Œ</li>
                        <li>æœæ—¥æ–°é—»</li>
                        <li>æ¯æ—¥æ–°é—»</li>
                        <li>æ–°æ˜æ—¥æŠ¥</li>
                        <li>ç«¯ä¼ åª’</li>
                    </ul>
                </div>

                <div class="border-l-4 border-amber-500 pl-4">
                    <h3 class="font-semibold text-gray-900 mb-2">å…¶ä»–è‡ªåŠ¨ä»»åŠ¡</h3>
                    <ul class="text-sm text-gray-600 list-disc list-inside">
                        <li>è‡ªåŠ¨ç¿»è¯‘ï¼šæ¯30åˆ†é’Ÿå¤„ç†å¾…ç¿»è¯‘æ–°é—»</li>
                        <li>è‡ªåŠ¨éªŒè¯ï¼šæ¯å°æ—¶å¤„ç†å¾…éªŒè¯æ–°é—»</li>
                        <li>æ¸…ç†æ—§æ•°æ®ï¼šæ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†30å¤©å‰çš„æ–°é—»</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥çŠ¶æ€
        async function checkStatus() {
            try {
                const response = await fetch('/api/admin/scheduler/status');
                const data = await response.json();

                if (data.success) {
                    const indicator = document.getElementById('status-indicator');
                    const text = document.getElementById('status-text');
                    const count = document.getElementById('jobs-count');
                    const jobsList = document.getElementById('jobs-list');
                    
                    if (data.status.running) {
                        indicator.className = 'w-4 h-4 rounded-full bg-green-500 animate-pulse';
                        text.textContent = 'è¿è¡Œä¸­';
                        text.className = 'text-green-600 font-semibold';
                        count.textContent = `(${data.status.jobs_count} ä¸ªä»»åŠ¡)`;
                        
                        // æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨
                        if (data.status.jobs && data.status.jobs.length > 0) {
                            jobsList.innerHTML = '<h3 class="font-semibold text-gray-900 mb-2">æ´»åŠ¨ä»»åŠ¡ï¼š</h3>' +
                                data.status.jobs.map(job => `
                                    <div class="text-sm text-gray-600 pl-4">
                                        â€¢ ${job.name} - ä¸‹æ¬¡è¿è¡Œ: ${job.next_run || 'æœªçŸ¥'}
                                    </div>
                                `).join('');
                        }
                    } else {
                        indicator.className = 'w-4 h-4 rounded-full bg-red-500';
                        text.textContent = 'å·²åœæ­¢';
                        text.className = 'text-red-600 font-semibold';
                        count.textContent = '';
                        jobsList.innerHTML = '';
                    }
                }
            } catch (error) {
                console.error('æ£€æŸ¥çŠ¶æ€å¤±è´¥:', error);
            }
        }

        // å¯åŠ¨å®šæ—¶ä»»åŠ¡
        async function startScheduler() {
            const message = document.getElementById('message');
            message.textContent = 'æ­£åœ¨å¯åŠ¨...';
            message.className = 'mt-4 text-sm text-blue-600';

            try {
                const response = await fetch('/api/admin/scheduler/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.success) {
                    message.textContent = data.message;
                    message.className = 'mt-4 text-sm text-green-600';
                    setTimeout(checkStatus, 1000);
                } else {
                    message.textContent = 'å¯åŠ¨å¤±è´¥: ' + data.error;
                    message.className = 'mt-4 text-sm text-red-600';
                }
            } catch (error) {
                message.textContent = 'å¯åŠ¨å¤±è´¥: ' + error.message;
                message.className = 'mt-4 text-sm text-red-600';
            }
        }

        // åœæ­¢å®šæ—¶ä»»åŠ¡
        async function stopScheduler() {
            const message = document.getElementById('message');
            message.textContent = 'æ­£åœ¨åœæ­¢...';
            message.className = 'mt-4 text-sm text-blue-600';

            try {
                const response = await fetch('/api/admin/scheduler/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.success) {
                    message.textContent = data.message;
                    message.className = 'mt-4 text-sm text-green-600';
                    setTimeout(checkStatus, 1000);
                } else {
                    message.textContent = 'åœæ­¢å¤±è´¥: ' + data.error;
                    message.className = 'mt-4 text-sm text-red-600';
                }
            } catch (error) {
                message.textContent = 'åœæ­¢å¤±è´¥: ' + error.message;
                message.className = 'mt-4 text-sm text-red-600';
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        checkStatus();
        // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
        setInterval(checkStatus, 10000);
    </script>
</body>
</html>
